<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>报告防伪查询</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 本地引用 Bootstrap 样式 -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/scrollUp.css">
    <link rel="stylesheet" href="css/loading.css">
    <style>
        body {
            font-size: 16px;
        }
        .error {
            color: red;
        }
        .img-report {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            background-color: #f5f5f5;
            margin-bottom: 2px;
        }
        .panel-body {
            padding: 3px;
        }
        #pdf-viewer {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container" style="margin-top: 5px;">
        <div id="loading" style="display: none;">加载中...</div>
        <div id="div_search_result">
            点击查看详细报告 <a href="javascript:void(0);" onclick="viewReport('ZFLJ6023357')">ZFLJ6023357</a>
        </div>
        <!-- 报告预览面板 -->
        <div id="pdf-viewer" style="display: none;">
            <div id="accordion"></div>
        </div>
        <!-- 滚动按钮 -->
        <a id="scrollUp" href="#top"></a>
        <br>
        <br>
    </div>

    <!-- 本地引用 jQuery 和 Bootstrap 脚本 -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scrollUp.js"></script>
    <script src="js/userAgent.js"></script>

    <script>
        // 模拟查询报告结果并渲染页面
        $(function () {
            var reportNo = "ZFLJ6023357";
            var html = '点击查看详细报告 <a href="javascript:void(0);" onclick="viewReport(\'' + reportNo + '\')">' + reportNo + '</a>';
            $("#div_search_result").html(html);
        });

        // 定义报告号的数组
        var reportArray = [];

        function contains(array, str) {
            return array.includes(str);
        }

        // 展示报告内容
        function viewReport(reportNo) {
            $("#pdf-viewer").show();
            var flag = false;

            if (!contains(reportArray, reportNo)) {
                flag = true;
                reportArray.push(reportNo);

                var html = '';
                html += '<div id="' + reportNo + '" class="panel panel-default">';
                html += '   <div class="panel-heading">';
                html += '       <h4 class="panel-title">';
                html += '           <a data-toggle="collapse" data-parent="#accordion" href="#collapse' + reportArray.length + '">';
                html += '               <span id="glyphicon_' + reportNo + '" class="glyphicon glyphicon-chevron-down"></span>';
                html += '               报告号：' + reportNo;
                html += '           </a>';
                html += '       </h4>';
                html += '   </div>';
                html += '   <div id="collapse' + reportArray.length + '" class="panel-collapse collapse in">';
                html += '       <div class="panel-body">';
                html += '           <embed src="pdf/' + reportNo + '.pdf" type="application/pdf" width="100%" height="600px" />';
                html += '       </div>';
                html += '   </div>';
                html += '</div>';

                $("#accordion").append(html);

                // 注册事件
                $('#' + reportNo).on('shown.bs.collapse', function () {
                    $("#glyphicon_" + reportNo).attr("class", "glyphicon glyphicon-chevron-up");
                });
                $('#' + reportNo).on('hidden.bs.collapse', function () {
                    $("#glyphicon_" + reportNo).attr("class", "glyphicon glyphicon-chevron-down");
                });
            }

            if (!flag) {
                d_collapse(reportNo);
            }
        }

        // 报告展开与折叠
        function d_collapse(reportNo) {
            var index = 0;
            for (var i = 0; i < reportArray.length; i++) {
                if (reportArray[i] == reportNo) {
                    index = i + 1;
                }
            }

            $('#collapse' + index.toString()).collapse('toggle');

            for (var i = 0; i < reportArray.length; i++) {
                if (i + 1 == index) {
                    $('#collapse' + (i + 1).toString()).collapse('show');
                } else {
                    $('#collapse' + (i + 1).toString()).collapse('hide');
                }
            }
        }
    </script>
</body>
</html>
